# EDS 222 Final Project Configuration
# Traffic, Land Use, and Roadkill in Denmark
# Author: Miller
# Last Updated: 2025-11-29

# Project metadata
project:
  name: "Traffic, Land Use, and Roadkill in Denmark"
  course: "EDS 222: Statistics for Environmental Data Science"
  crs: 25832  # Denmark ETRS89 / UTM zone 32N
  denmark_bbox:
    xmin: 8.07
    ymin: 54.56
    xmax: 15.25
    ymax: 57.75
    crs: 4326  # WGS84 for bbox definition

# Data paths and metadata
data:
  # Raw data inputs (read-only, not modified by analysis)
  raw:
    roadkill:
      path: "data/raw/Global Roadkill data.csv"
      description: "Global roadkill observation data with coordinates and species"
      source: "Global Roadkill Database"
      time_period: "2017-2019 (filtered for Denmark)"
      columns:
        - country
        - year
        - decimalLongitude
        - decimalLatitude
        - vernacularName
        - numberOfRoadkill
      notes: "Filter to Denmark (country == 'Denmark') and years 2017-2019 to match CORINE 2018"

    roads:
      path: "data/raw/OSM_dk_roads_shp/gis_osm_roads_free_1.shp"
      description: "OpenStreetMap road network for Denmark"
      source: "OpenStreetMap via Geofabrik"
      geometry_type: "LINESTRING"
      key_fields:
        - osm_id
        - code
        - fclass
        - maxspeed
      car_accessible_codes:
        major: [5111, 5112, 5113, 5114, 5115]  # motorway, trunk, primary, secondary, tertiary
        minor: [5121, 5122, 5123]  # unclassified, residential, service
        links: [5131, 5132, 5133, 5134, 5135]  # ramps/connectors
      notes: "Filter to car-accessible roads using code field. Calculate road length in km."

    traffic:
      path: "data/raw/ODN_dk_traffic_shp/OPEN_DATA_NOEGLETAL_VIEWPoint.shp"
      description: "Danish traffic monitoring points with AADT measurements"
      source: "Vejdirektoratet (Danish Road Directorate)"
      geometry_type: "POINT"
      key_fields:
        - AAR  # Year
        - AADT  # Annual Average Daily Traffic
      notes: "Point locations of traffic monitoring stations. Match to roads using nearest neighbor with distance threshold."

    landuse:
      path: "data/raw/OSM_dk_landuse_shp/gis_osm_landuse_a_free_1.shp"
      description: "OpenStreetMap land use polygons for Denmark"
      source: "OpenStreetMap via Geofabrik"
      geometry_type: "POLYGON"
      key_fields:
        - fclass  # Land use classification
      notes: "Alternative to CORINE for land cover analysis. Extract proportions within road buffers."

    corine:
      path: "data/raw/u2018_clc2018_v2020_20u1_raster100m/DATA/U2018_CLC2018_V2020_20u1.tif"
      description: "CORINE Land Cover 2018 raster (100m resolution)"
      source: "Copernicus Land Monitoring Service"
      year: 2018
      resolution: "100m"
      land_cover_codes:
        urban: [111, 142]  # 1xx codes
        agriculture: [211, 244]  # 2xx codes
        forest: [311, 324]  # 3xx codes
        wetland_water: [411, 523]  # 4xx-5xx codes
      notes: "Large raster file. Crop to Denmark bbox BEFORE reprojection for efficiency. Calculate land cover proportions within 500m road buffers."

  # Processed/cached data (generated by analysis scripts)
  processed:
    roads_cached:
      path: "data/processed/roads_dk_epsg25832.rds"
      description: "Cached roads shapefile (cropped and reprojected)"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: "data.raw.roads"
      notes: "Saves reprojection time. Regenerate if source data changes."

    traffic_cached:
      path: "data/processed/traffic_dk_epsg25832.rds"
      description: "Cached traffic points (cropped and reprojected)"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: "data.raw.traffic"
      notes: "Saves reprojection time. Regenerate if source data changes."

    landuse_cached:
      path: "data/processed/landuse_dk_epsg25832.rds"
      description: "Cached land use polygons (cropped and reprojected)"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: "data.raw.landuse"
      notes: "Saves reprojection time. Regenerate if source data changes."

    corine_cached:
      path: "data/processed/corine_dk_epsg25832.tif"
      description: "Cached CORINE raster (cropped and reprojected to Denmark)"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: "data.raw.corine"
      notes: "Large file. Crop in native CRS first, then reproject for efficiency."

    distances_cache:
      path: "data/processed/distances_cache_2017_2019.rds"
      description: "Cached road-to-traffic distances and nearest neighbor indices"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: ["roads_cached", "traffic_cached"]
      notes: "Computationally expensive. Contains nearest_idx and distances for matching traffic to roads."

    roadkill_cache:
      path: "data/processed/roadkill_by_segment_2017_2019.rds"
      description: "Cached roadkill counts aggregated by road segment"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: ["roads_cached", "roadkill (raw)"]
      notes: "Spatial join is expensive. Contains osm_id and roadkill_count."

    landcover_props:
      path: "data/processed/landcover_props_2017_2019.rds"
      description: "Cached land cover proportions within 500m road buffers"
      generated_by: "eds222-analysis-scaled.qmd"
      depends_on: ["roads_cached", "corine_cached"]
      notes: "Raster extraction is very slow. Contains pct_urban, pct_agriculture, pct_forest, pct_wetland_water."

# Analysis parameters
analysis:
  time_period: "2017-2019"
  road_buffer_distance: 500  # meters for land cover extraction
  traffic_matching:
    method: "nearest_neighbor"
    distance_threshold_percentile: 0.75
    notes: "Use 75th percentile of road-to-traffic distances as threshold"

  model:
    type: "hurdle"
    distribution: "negbin"  # Negative binomial for count component
    zero_dist: "binomial"  # Logistic for zero-inflation component
    offset: "log(len_km)"  # Control for road length exposure
    predictors:
      - log_AADT
      - road_type
      - speed_limit
      - pct_forest
      - pct_agriculture
      - pct_urban

# Reproducibility
reproducibility:
  seed: 42
  r_version: "4.x"
  key_packages:
    - tidyverse
    - sf
    - terra
    - here
    - pscl
  notes: "All cached files can be regenerated by deleting them and re-running the analysis script."

# File management
file_management:
  gitignore_patterns:
    - "data/processed/*"  # All cached/processed files
    - "data/raw/*"  # Raw data files (too large for git)
  tracked_files:
    - "config.yml"  # This configuration file
    - "*.qmd"  # Analysis scripts
    - "*.R"  # R scripts
    - "README.md"
  notes: "Raw data should be stored separately (e.g., Google Drive, institutional storage). Processed cache files are regenerated automatically."
